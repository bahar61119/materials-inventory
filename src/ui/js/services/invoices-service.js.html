<script>
    class InvoicesService {
        static #invoiceList = [];

        static setInvoiceListData() {
            API.getInvoiceList(
                dataReturned => {
                    InvoicesService.#invoiceList = dataReturned.slice();
                    InvoicesService.search();
                    if(InvoicesService.#invoiceList.length === 0) {
                        Alert.show(
                            AlertOptions.of()
                                .withTitle("Not Found")
                                .withMessage("Please add a new invoice")
                                .withType(AlertOptions.Type.WARNING)
                        );

                        ConfirmationModal.show(
                            ConfirmationModalOptions.of()
                                .withTitle("Not Found")
                                .withMessage(`Do you want to add new invoice?`)
                                .withCallback(()=>{
                                    Alert.hide();
                                    InvoicesViewService.loadAddInvoiceView();
                                })
                                .withType(ConfirmationModalOptions.Type.WARNING)
                        );
                    }
                },
                error => {
                    console.error(error);
                    Alert.show(
                        AlertOptions.of()
                            .withTitle("Loading Error")
                            .withMessage(error.message)
                            .withType(AlertOptions.Type.DANGER)
                    );
                }
            );
        }

        static search() {
            BaseService.search(InvoicesService.#invoiceList, "invoiceId", "invoiceName", "Invoices");
        }

        static deleteInvoice(invoiceId) {
            BaseService.delete(invoiceId, "Invoice", API.deleteInvoice, InvoicesService.setInvoiceListData);
        }

        static updateInvoice(isEdit = true) {
            let invoice = InvoicesService.#getInvoice(isEdit);
            BaseService.update(invoice, "Invoice", API.updateInvoice, isEdit);
        }

        static #getInvoice(isEdit = true) {
            let invoiceIssueDate = $(`#${ElementId.Invoices.INVOICE_ISSUE_DATE}`).val();
            let invoiceReceivedDate = $(`#${ElementId.Invoices.INVOICE_RECEIVED_DATE}`).val();
            return Invoice.of()
                .withInvoiceId(isEdit? $(`#${ElementId.Invoices.INVOICE_ID}`).val(): '')
                .withInvoiceName($(`#${ElementId.Invoices.INVOICE_NAME}`).val())
                .withInvoiceReferenceNumber($(`#${ElementId.Invoices.INVOICE_REFERENCE_NUMBER}`).val())
                .withInvoiceSupplierId($(`#${ElementId.Invoices.INVOICE_SUPPLIER_ID}`).val())
                .withInvoiceTotalAmount($(`#${ElementId.Invoices.INVOICE_TOTAL_AMOUNT}`).val())
                .withInvoiceIssueDate(invoiceIssueDate? (new Date(invoiceIssueDate)).getTime().toString(): '')
                .withInvoiceReceivedDate(invoiceReceivedDate? (new Date(invoiceReceivedDate)).getTime().toString(): '')
                .withInvoiceRemark($(`#${ElementId.Invoices.INVOICE_REMARK}`).val())
                .withInvoiceFile($(`#${ElementId.Invoices.INVOICE_FILE}`).val())
        }
    }
</script>